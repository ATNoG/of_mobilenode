<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>OF Mobile Node</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">OF Mobile Node</h1>
        <p class="header"></p>
		    <dl>
        	<h5>Table of Contents</h5>
        	<dd><a href="index.html">Introdution</a></dd>
        	<dd><a href="#started">Getting Started</a></dd>
                <dt><a href="#installation">1. Installation</a></dt>
                <dt><a href="#software">2. Requerid Software</a></dt>
                  <p><a href="#ovs">2.1. Open vSwicth</a></p>
                  <p><a href="#pox">2.2. POX</a></p>
                <dt><a href="#demo">3. Running a demo</a></dt>
          <dd><a href="framework.html">System Framework</a></dd>
        	<dd><a href="index.html#authors">Authors & Copyright</a></dd>
        </dl>
        <ul>
          <li class="download"><a class="buttons" href="https://github.com/ATNoG/of_mobilenode/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/ATNoG/of_mobilenode/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/ATNoG/of_mobilenode">View On GitHub</a></li>
        </ul>
      </header>
      <section>

<h2><a id="started" class="anchor" href="#started" aria-hidden="true"><span class="octicon octicon-link"></span>Getting Started</a></h2>
	

<h3><a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span>1. Installation</a></h3>
In this project we did not developed new software, instead we use explore the configuration of softwares already develop and distribuited as open-source. So, instead of presenting how to do the installation we will rather present the needed configuration to reproduce an experience.

<h3><a id="software" class="anchor" href="#software" aria-hidden="true"><span class="octicon octicon-link"></span>2. Required Software</a></h3>
With the purpose of extending the OpenFlow control path up to the mobile node, the OvS with its dependencies was installed in every network node, except on the controller node, where the POX was used as the OpenFlow agent in that node.

<h4><a id="ovs" class="anchor" href="#ovs" aria-hidden="true"><span class="octicon octicon-link"></span>2.1. Open vSwitch</a></h4>
Since we do not develop or change the OvS software, here we will not explain the its installation, rather we will just explain how the configuration was done. 
To install you can follow the steps presented on Open vSwitch <a href="https://github.com/openvswitch/ovs" target="_blank">github</a>.

<h5>2.1.1. OvS configuration</h5>
<p>The configuration applied to the OvS software in the nodes was a conventional layer 3 switch, where each network interface has a OvS bridge attached with an associated IP address. The forwarding packets process was taken by the nodes' kernel, leaving to the OvS the possibility of changing the packtes or applying a new forwarding rule.
Below is shown a possible OvS configuration for the network nodes.</p>

<h6>a) Router, APs and Listener</h6>
<p>This example was used to configure the Router node. The remain nodes configuration is similar, keeping in mind that is necessary to change to the respectives network interfaces and IP addresses. It is also important to set the connection mode of the controller to out-of-band. The configuration of the mobile nodes shows how this can be done.</p>
<p>The following command line enable the packets forwarding, and it is necessary to allow the router and APs nodes forward the receiving packets.<br><code>echo 1 > /proc/sys/net/ipv4/ip_forward</code></p>



<pre><code># add bridge to ethernet interfaces
ovs-vsctl add-br router

# attach interfaces to bridges
ovs-vsctl add-port router control.4

# connect OVS to a controller - "in-band"
ovs-vsctl set-controller router tcp:10.10.10.201:6633

# set attached interfaces in promiscous mode
ifconfig control.4 0 up

# start ovs bridges
ifconfig router 192.168.10.254 netmask 255.255.255.0 up
</pre></code>

<h6>b) Mobile Node</h6>
<p>
  The OvS configuration applied to the mobile node has is somehow different of the other network nodes, due to the need of applying new forwarding rule over the kernels forwarding, in order to forward the packet to the other wireless interface. To do that the both mobile node's OvS bridges, attached of each wireless interface, were interconnected by a patch port that will act as a patch cable. Below is shown an exemple of a mobile node's Ovs configuration.</p>

<pre><code># add bridge to ethernet interfaces
ovs-vsctl add-br br0
ovs-vsctl add-br br1

# attach interfaces to bridges
ovs-vsctl add-port br0 ath0
ovs-vsctl add-port br1 ath1

# create a patch port for each bridge
ovs-vsctl add-port br0 patch01 -- set interface patch01 type=patch options:peer=patch10
ovs-vsctl add-port br1 patch10 -- set interface patch10 type=patch options:peer=patch01

# connect OVS to a controller - "out-of-band"
ovs-vsctl set-controller br0 tcp:10.10.15.201:6633
ovs-vsctl set-controller br1 tcp:10.10.10.201:6633
ovs-vsctl set controller br0 connection-mode=out-of-band
ovs-vsctl set controller br1 connection-mode=out-of-band
ovs-vsctl set bridge br0 other-config:disable-in-band=true
ovs-vsctl set bridge br1 other-config:disable-in-band=true

# set attached interfaces in promiscous mode
ifconfig ath0 0 up
ifconfig ath1 0 up

# start ovs bridges
ifconfig br0 192.168.11.1 netmask 255.255.255.0 up
ifconfig br1 192.168.12.1 netmask 255.255.255.0 up
</code></pre>
<h4><a id="pox" class="anchor" href="#pox" aria-hidden="true"><span class="octicon octicon-link"></span>2.2. POX</a></h4>
<p>As OpenFlow controller we choose POX. But if you are more familiar with another controller it can be also done. However you need to create a script capable to handle the handover trigger form the user device, and change some code in order to avoid the controller ereasing the OvS flow rules when a new connection is establish.</p>  
<p>If you decide to use POX, you can download it form our <a href="https://github.com/ATNoG/of_mobilenode" target="_blank">github</a> with the necessary changes already done, or download it from the <a href="https://github.com/noxrepo/pox" target="_blank">oficial</a> developer and do yourself the changes.</p>

<h6>a) How to run POX</h6>
<p>POX officially requires Python 2.7 (though much of it will work fine fine with Python 2.6), and should run under Linux, Mac OS, and Windows.</p>

<code><pre>
The script ext/handover_mn.py handles the Mobile Node handover request. 
Run it along with l3_learning
* You can run with the "py" component and use the CLI:
  ./pox.py forwarding.l3_learning handover_mn py

The script ext/handover_mn_rules.py handles the Mobile Node handover request 
while implementes a certain number of dummy rules. As in the script before, 
run it along with l3_learning

* You can run with the "py" component and use the CLI:
  ./pox.py forwarding.l3_learning handover_mn_rules py
</code></pre>


<h3><a id="demo" class="anchor" href="#demo" aria-hidden="true"><span class="octicon octicon-link"></span>3. Running a demo</a></h3>
<p>
  The demo here described suposes an already installation of the software nodes and the link between them already established. Rather than we will described the necessary rules pre-implemented rules on the OvS bridges and how to stream the a video. To stream the video you choose the <a href="http://www.videolan.org/vlc/" target="_blank"> VLC</a> application, however if you have another streaming application that you are more familiar with, you can use it as well.
</p>
<p>To install the VLC app on ubuntu you can use the following command:<pre><code>sudo apt-get install vlc-nox</code></pre></p>

<h6>a) Network architecture</h6>
<div style="float:right; width:35%"><img src="images/network.jpg" width="90%" align="right"></div>
<p>
  The project was develop exploring a tree network topology with 6 nodes (2 access points, router, network controller, mobile node and a terminal). We also explore the fact of the mobile node beeing the source content, streaming a video through the network towards the terminal receiver. Keeping that in mind, the mobile node has a wireless connection with both AP's, whereas all the other nodes have a physical link connection. All nodes can ping each other.
</p>



<h6>b) Setting up the network</h6>
<p>
  how to set up
</p>


<h6>c) Start running</h6>
<p>Here we show an example of a demo through a bash script.</p>
  <pre><code>#!/bin/bash
# DEMO: handover with openflow
## start capture
sudo tcpdump -ni ath1 -w file_ath1_dump.pcap &
sudo tcpdump -ni ath0 -w file_ath0_dump.pcap &
## implement basic rules in MobileNode's ovs-bridges 
sudo ./rules.sh
sleep 2

## T=0
# start video streaming
cvlc -dvvv BigBuckBunny1080p.mp4 --sout '#duplicate{dst=rtp{{mux=ts,dst=192.168.10.1}}}'
sleep 20
## T=20
# reduce the troughput - decrease the TxPower and bit rate
sudo iwconfig ath0 txpower 1
sudo iwconfig ath0 rate 5.5M
sleep 10
## T=30
# send "handover" solicitation packet to the controller
echo “help” > /dev/udp/11.11.11.11/58549
sleep 30

## T=60
# kill the processes
sudo pkill tcpdump
pkill vlc</code></pre>

      </section>
      <footer>
        <small>
 
		</small>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
